# 第七章-作业

## 1

假设我们对一个数据结构执行 $n$ 次操作，如果 $i$ 是 $2$ 的乘方则第 $i$ 个操作的开销为 $i$，否则为 $1$。分别使用聚集法、会计法和势能法分析操作的平摊代价。



答：

设第 $i$ 个操作的代价为 $c(i)$，则：

$$
\begin{equation}
c(i) = \begin{cases}
i + 1, & \text{if i 是 2 的幂}; \\
1, & \text{if i 不是 2 的幂}.
\end{cases}
\end{equation}
$$

### 聚集法

$$
\begin{equation} \begin{split}
\sum_{i=1}^n c(i) &= \sum_{i=1}^{\lceil \lg n \rceil} 2^i + \sum_{\text{i 不是 2 的幂}} 1 \\
&\le \sum_{i=1}^{\lceil \lg n \rceil} 2^i + n = 2^{\lceil \lg n \rceil + 1} - 1 + n \\
&\le 2n - 1 + n \le 3n = O(n)
\end{split} \end{equation}
$$

因此平摊代价为 $O(1)$。

### 会计法

设每次操作花费 $3$ 。

显然第 $2^0$ 次操作有可用资金。

当第 $2^i$ 次操作有可用资金时，对于第  $2^{i+1}$  次操作，操作之后剩余资金总数为：

$$
W = 3 \times 2^{i+1} - (2^{i+1} - (i+1) + 2^{i+2} - 2) = i + 3 > 0
$$

即第 $2^{i+1}$ 次操作也有可用资金。

综上可知，$\forall i \ge 0$，第 $2^i$ 次操作都有可用资金。

而对于任意 $2^i < j < 2^{i+1}$，第 $j$ 次操作之后剩余资金总数为：

$$
W = i + 2 + 2(j - 2^i) > 0
$$

即所有操作都有可用资金。

总投入为 $3n$，平摊代价为 $O(1)$。

### 势能法

定义：

- $\Phi(D_0) = 0$
- 第 $i$ 次操作后数据结构的势能函数：$\Phi(D_i) = 2i - 2^{\lfloor \lg i \rfloor + 1} \ge 0, \, i \ge 1$



- 若 $i \ne 2^j$，$c_i = 1 + \Phi(D_i) - \Phi(D_{i-1}) = 1 + 2 = 3$
- 若 $i = 2^j$，$c_i = i + \Phi(D_i) - \Phi(D_{i-1}) = i + (2i - 2^{j+1}) - (2(i-1) - 2^{j-1 + 1}) = 2$

因此平摊代价为 $O(1)$。

## 2

*Bill* 提出了一种称为翻转栈的数据结构，该结构仅支持 Flip_push() 操作。 每次执行 Flip_push() 时，首先入栈，然后检查栈中的对象数是否为 $2$ 的幂。 如果是，则将翻转栈中的所有对象。 

例如，我们使用 Flip_push() 将对象 $1$、$2$、$3$ 和 $4$ 压入栈。堆栈的内容变化（从下至上）如下：

$(1)⇒(2,1)⇒(2,1,3)⇒(4,3,1,2)$。

你需要使用分别使用聚集法、会计法和势能法分析 Flipping_push() 函数的摊销成本。 

堆栈反转的成本等于堆栈中现有对象的数量。



答：

设第 $i$ 个操作的代价为 $c(i)$，则：

$$
\begin{equation}
c(i) = \begin{cases}
i + 1, & \text{if i 是 2 的幂}; \\
1, & \text{if i 不是 2 的幂}.
\end{cases}
\end{equation}
$$

### 聚集法

$$
\begin{equation} \begin{split}
\sum_{i=1}^n c(i) &= \sum_{i=1}^{\lceil \lg n \rceil} 2^i + \sum_{\text{i 不是 2 的幂}} 1 \\
&\le \sum_{i=1}^{\lceil \lg n \rceil} 2^i + n = 2^{\lceil \lg n \rceil + 1} - 1 + n \\
&\le 2n - 1 + n \le 3n = O(n)
\end{split} \end{equation}
$$

因此平摊代价为 $O(1)$。(没点区别)

### 会计法

设每次操作花费 $3$。

显然第 $2^0$ 次操作有可用资金。

当第 $2^i$ 次操作有可用资金时，对于第  $2^{i+1}$  次操作，操作之后剩余资金总数为：

$$
W = 3 \times 2^{i+1} - (2^{i+1} + 2^{i+2} - 2) = 2 > 0
$$

即第 $2^{i+1}$ 次操作也有可用资金。

综上可知，$\forall i \ge 0$，第 $2^i$ 次操作都有可用资金。

而对于任意 $2^i < j < 2^{i+1}$，第 $j$ 次操作之后剩余资金总数为：

$$
W = 2 + 2(j - 2^i) > 0
$$

即所有操作都有可用资金。

总投入为 $3n$，平摊代价为 $O(1)$。

### 势能法

定义：

- $\Phi(D_0) = 0$
- 第 $i$ 次操作后数据结构的势能函数：$\Phi(D_i) = 2i - 2^{\lfloor \lg i \rfloor + 1} \ge 0, \, i \ge 1$



- 若 $i \ne 2^j$，$c_i = 1 + \Phi(D_i) - \Phi(D_{i-1}) = 1 + 2 = 3$
- 若 $i = 2^j$，$c_i = 1 + i + \Phi(D_i) - \Phi(D_{i-1}) = 1 + i + (2i - 2^{j+1}) - (2(i-1) - 2^{j-1 + 1}) = 3$

因此平摊代价为 $O(1)$。

